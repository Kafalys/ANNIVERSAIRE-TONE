<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZZ</title>
    <link rel="icon" href="images/LOGO.png" type="image/png">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Barre de navigation -->
    <div id="nav-placeholder"></div>

    <!-- Contenu principal -->
    <div class="container">
        <h1><img src="https://static-cdn.jtvnw.net/emoticons/v2/302234940/static/light/3.0" class="mirror-horizontal" style="width: 56px; height: 56px; vertical-align: middle;" alt=""> QUIZZ <img src="https://static-cdn.jtvnw.net/emoticons/v2/302234940/static/light/3.0" style="width: 56px; height: 56px; vertical-align: middle;" alt=""></h1>
        
        <div class="quiz-container" id="quizContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
            
            <div class="question-card">
                <div class="question-number" id="questionNumber">Question 1/10</div>
                <div class="question-text" id="questionText">Chargement de la question...</div>
                
                <div class="answers-grid" id="answersContainer">
                    <!-- Les r√©ponses seront g√©n√©r√©es par JavaScript -->
                </div>
            </div>
            
           <div class="quiz-navigation">
                <div class="score-display" id="scoreDisplay">Score: 0/0</div>
                <button class="nav-button" id="validateButton">Valider</button>
                <button class="nav-button" id="nextButton" style="display: none;">Suivant</button>
            </div>
        </div>
    </div>

    <!-- Modal pour les infos sur les r√©ponses -->
    <div id="popupModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Infos</h2>
            <p id="popupText"></p>
            <button class="modal-button" onclick="closeModal()">OK</button>
        </div>
    </div>

<script>

    // Questions du quiz - charg√©es depuis un fichier JSON
    let questions = [];

    async function loadQuestions() {
        try {
            const response = await fetch('data/questions.json');
            if (!response.ok) {
                throw new Error('Erreur HTTP: ' + response.status);
            }
            questions = await response.json();
            loadQuestion();
        } catch (error) {
            console.error('Erreur lors du chargement des questions:', error);
            alert('Impossible de charger les questions. V√©rifiez la connexion ou le fichier.');
        }
    }

    let currentQuestion = 0;
    let score = 0;
    let selectedAnswer = null;
    let answered = false; // Nouveau : savoir si on a d√©j√† valid√© cette question

    function loadQuestion() {
        const q = questions[currentQuestion];
        document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1}/${questions.length}`;
        document.getElementById('questionText').textContent = q.question;
        
        const container = document.getElementById('answersContainer');
        container.innerHTML = '';
        
        // R√©initialiser l'√©tat
        selectedAnswer = null;
        answered = false;
        
        q.answers.forEach((answer, index) => {
            const button = document.createElement('button');
            button.className = 'answer-button';
            button.innerHTML = answer;
            button.onclick = () => selectAnswer(index);
            container.appendChild(button);
        });
        
        // Afficher/masquer les bons boutons
        document.getElementById('validateButton').style.display = 'inline-block';
        document.getElementById('nextButton').style.display = 'none';
        
        updateProgress();
        updateNavButtons();
        updateScoreDisplay();
    }

    function selectAnswer(index) {
        // Ne pas permettre de changer si d√©j√† valid√©
        if (answered) return;
        
        selectedAnswer = index;
        
        const buttons = document.querySelectorAll('.answer-button');
        buttons.forEach((btn, i) => {
            btn.classList.remove('selected');
            if (i === index) btn.classList.add('selected');
        });
    }

    function validateAnswer() {
        // V√©rifier qu'une r√©ponse est s√©lectionn√©e
        if (selectedAnswer === null) {
            alert('Veuillez s√©lectionner une r√©ponse !');
            return;
        }
        // Si d√©j√† valid√©, ne rien faire
        if (answered) return;
        answered = true;
        const correct = questions[currentQuestion].correct;
        const buttons = document.querySelectorAll('.answer-button');

        // G√©rer plusieurs bonnes r√©ponses (tableau ou nombre)
        let isCorrect = false;
        if (Array.isArray(correct)) {
            // Plusieurs bonnes r√©ponses
            isCorrect = correct.includes(selectedAnswer);
            // Afficher toutes les bonnes r√©ponses en vert
            correct.forEach(idx => {
                if (buttons[idx]) buttons[idx].classList.add('correct');
            });
        } else {
            // Une seule bonne r√©ponse
            isCorrect = (selectedAnswer === correct);
            buttons[correct].classList.add('correct');
        }

        // Si la r√©ponse s√©lectionn√©e est fausse, l'afficher en rouge
        if (!isCorrect) {
            buttons[selectedAnswer].classList.add('incorrect');
        } else {
            // Bonne r√©ponse : incr√©menter le score
            score++;
        }

        // D√©sactiver tous les boutons de r√©ponse
        buttons.forEach(btn => {
            btn.style.cursor = 'default';
            btn.onclick = null;
        });

        // Masquer "Valider" et afficher "Suivant"
        document.getElementById('validateButton').style.display = 'none';
        document.getElementById('nextButton').style.display = 'inline-block';

        // Mettre √† jour l'affichage du score
        updateScoreDisplay();

        // Afficher le modal avec l'info sur la r√©ponse
        openModal(questions[currentQuestion].popup, isCorrect);
    }

    function updateProgress() {
        const progress = ((currentQuestion) / questions.length) * 100;
        document.getElementById('progressBar').style.width = progress + '%';
    }

    function updateNavButtons() {
        const nextBtn = document.getElementById('nextButton');
        nextBtn.textContent = currentQuestion === questions.length - 1 ? 'Terminer' : 'Suivant';
    }

    function updateScoreDisplay() {
        // Afficher le score actuel / nombre total de questions
        document.getElementById('scoreDisplay').textContent = `Score: ${score}/${questions.length}`;
    }

    // Gestionnaire pour le bouton "Valider"
    document.getElementById('validateButton').onclick = validateAnswer;

    // Gestionnaire pour le bouton "Suivant"
    document.getElementById('nextButton').onclick = () => {
        if (!answered) {
            alert('Veuillez d\'abord valider votre r√©ponse !');
            return;
        }
        
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            loadQuestion();
        } else {
            showResults();
        }
    };


    function showResults() {
        const percentage = Math.round((score / questions.length) * 100);
        let message = '';
        
        if (percentage >= 80) {
            message = "Excellent ! Tu connais vraiment bien TONE ! üéâ";
        } else if (percentage >= 60) {
            message = "Bien jou√© ! Tu connais pas mal de choses sur TONE ! üëç";
        } else if (percentage >= 40) {
            message = "Pas mal ! Mais tu peux encore mieux conna√Ætre TONE ! üòä";
        } else {
            message = "Il va falloir passer plus de temps avec TONE ! üòÑ";
        }
        
        const quizContainer = document.getElementById('quizContainer');
        quizContainer.innerHTML = `
            <div class="results-card">
                <div class="results-title">Quiz Termin√© !</div>
                <div class="results-score">${score}/${questions.length}</div>
                <div class="results-message">${message}<br><br>Tu as obtenu ${percentage}% de bonnes r√©ponses !</div>
                <button class="restart-button" onclick="restartQuiz()">Recommencer le Quiz</button>
                <br><br>
                <a href="index.html" class="nav-button" style="display: inline-block; text-decoration: none; margin-top: 20px;">Retour √† l'accueil</a>
            </div>
        `;
    }

    function restartQuiz() {
        currentQuestion = 0;
        score = 0;
        selectedAnswer = null;
        answered = false;
        
        const quizContainer = document.getElementById('quizContainer');
        quizContainer.innerHTML = `
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
            
            <div class="question-card">
                <div class="question-number" id="questionNumber">Question 1/${questions.length}</div>
                <div class="question-text" id="questionText">Chargement de la question...</div>
                
                <div class="answers-grid" id="answersContainer">
                </div>
            </div>
            
            <div class="quiz-navigation">
                <div class="score-display" id="scoreDisplay">Score: 0/${questions.length}</div>
                <button class="nav-button" id="validateButton">Valider</button>
                <button class="nav-button" id="nextButton" style="display: none;">Suivant</button>
            </div>
        `;
        
        // R√©attacher les √©v√©nements
        document.getElementById('validateButton').onclick = validateAnswer;
        document.getElementById('nextButton').onclick = () => {
            if (!answered) {
                alert('Veuillez d\'abord valider votre r√©ponse !');
                return;
            }
            
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                showResults();
            }
        };
        
        loadQuestion();
    }

    // Charger les questions et la premi√®re question au d√©marrage
    loadQuestions();

    // Fonctions pour le modal
    function openModal(text, isCorrect) {
        const titleElement = document.getElementById('modalTitle');
        const modal = document.getElementById('popupModal');
        
        document.getElementById('popupText').innerHTML = text;
        
        if (isCorrect) {
            titleElement.innerHTML = '<img src="https://static-cdn.jtvnw.net/emoticons/v2/emotesv2_1a48f8cf505246f0b205799c73829cfb/static/light/3.0" style="width: 56px; height: 56px; vertical-align: middle;">    Bonne r√©ponse    <img src="https://static-cdn.jtvnw.net/emoticons/v2/emotesv2_1a48f8cf505246f0b205799c73829cfb/static/light/3.0" class="mirror-horizontal" style="width: 56px; height: 56px; vertical-align: middle;">';
            titleElement.className = 'correct-title';
        } else {
            titleElement.innerHTML = '<img src="https://static-cdn.jtvnw.net/emoticons/v2/emotesv2_0b9b5b51652f4617bdad48735ed00775/static/light/3.0" style="width: 56px; height: 56px; vertical-align: middle;">    Mauvaise r√©ponse    <img src="https://static-cdn.jtvnw.net/emoticons/v2/emotesv2_0b9b5b51652f4617bdad48735ed00775/static/light/3.0" class="mirror-horizontal" style="width: 56px; height: 56px; vertical-align: middle;">';
            titleElement.className = 'incorrect-title';
        }
        
        modal.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('popupModal').style.display = 'none';
    }
</script>

<script>
    // Charger la navigation depuis le template
    fetch('templates/header.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('nav-placeholder').innerHTML = data;
            // Attacher l'√©v√©nement apr√®s chargement
            document.getElementById('credits-link').addEventListener('click', openCreditsModal);
        });

    // Fonctions pour le modal des cr√©dits
    function openCreditsModal() {
        document.getElementById('creditsModal').style.display = 'block';
    }

    function closeCreditsModal() {
        document.getElementById('creditsModal').style.display = 'none';
    }
</script>
</body>

</html>
